<!DOCTYPE html>
<html class="client-nojs" dir="ltr" lang="en">
 <head>
  <meta charset="utf-8"/>
  <title>
   SLURM/Preemption - UMIACS
  </title>
  <script>
   document.documentElement.className="client-js";RLCONF={"wgBreakFrames":false,"wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgRequestId":"Zv3G3LVF3Uo0ToGGyPteEwAAAAU","wgCSPNonce":false,"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"SLURM/Preemption","wgTitle":"SLURM/Preemption","wgCurRevisionId":11792,"wgRevisionId":11792,"wgArticleId":3261,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgRelevantPageName":"SLURM/Preemption","wgRelevantArticleId":3261,"wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgVector2022PreviewPages":[]};RLSTATE={"site.styles":"ready",
"user.styles":"ready","user":"ready","user.options":"loading","skins.vector.styles.legacy":"ready"};RLPAGEMODULES=["site","mediawiki.page.ready","mediawiki.toc","skins.vector.legacy.js"];
  </script>
  <script>
   (RLQ=window.RLQ||[]).push(function(){mw.loader.implement("user.options@12s5i",function($,jQuery,require,module){mw.user.tokens.set({"patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});});});
  </script>
  <link href="/umiacs/load.php?lang=en&amp;modules=skins.vector.styles.legacy&amp;only=styles&amp;skin=vector" rel="stylesheet"/>
  <script async="" src="/umiacs/load.php?lang=en&amp;modules=startup&amp;only=scripts&amp;raw=1&amp;skin=vector">
  </script>
  <meta content="" name="ResourceLoaderDynamicStyles"/>
  <link href="/umiacs/load.php?lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=vector" rel="stylesheet"/>
  <meta content="MediaWiki 1.39.7" name="generator"/>
  <meta content="telephone=no" name="format-detection"/>
  <meta content="width=1000" name="viewport"/>
  <link href="/favicon.ico" rel="icon"/>
  <link href="/umiacs/opensearch_desc.php" rel="search" title="UMIACS (en)" type="application/opensearchdescription+xml"/>
  <link href="https://wiki.umiacs.umd.edu/umiacs/api.php?action=rsd" rel="EditURI" type="application/rsd+xml"/>
  <link href="/umiacs/index.php?title=Special:RecentChanges&amp;feed=atom" rel="alternate" title="UMIACS Atom feed" type="application/atom+xml"/>
 </head>
 <body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-SLURM_Preemption rootpage-SLURM_Preemption skin-vector action-view skin-vector-legacy vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-language-alert-in-sidebar-disabled vector-feature-sticky-header-disabled vector-feature-sticky-header-edit-disabled vector-feature-table-of-contents-disabled vector-feature-visual-enhancement-next-disabled">
  <div class="noprint" id="mw-page-base">
  </div>
  <div class="noprint" id="mw-head-base">
  </div>
  <div class="mw-body" id="content" role="main">
   <a id="top">
   </a>
   <div id="siteNotice">
   </div>
   <div class="mw-indicators">
   </div>
   <h1 class="firstHeading mw-first-heading" id="firstHeading">
    <span class="mw-page-title-main">
     SLURM/Preemption
    </span>
   </h1>
   <div class="vector-body" id="bodyContent">
    <div class="noprint" id="siteSub">
     From UMIACS
    </div>
    <div id="contentSub">
    </div>
    <div id="contentSub2">
    </div>
    <div id="jump-to-nav">
    </div>
    <a class="mw-jump-link" href="#mw-head">
     Jump to navigation
    </a>
    <a class="mw-jump-link" href="#searchInput">
     Jump to search
    </a>
    <div class="mw-body-content mw-content-ltr" dir="ltr" id="mw-content-text" lang="en">
     <div class="mw-parser-output">
      <p>
       If you are submitting to a partition which is eligible for preemption (e.g. scavenger), you are responsible for making sure that your job can be interrupted/restarted gracefully. Here we are documenting some Slurm behaviors that you can use to determine if your job has been cancelled or preempted. You should be able to take different code paths during startup/shutdown of your jobs based on this information.
      </p>
      <div aria-labelledby="mw-toc-heading" class="toc" id="toc" role="navigation">
       <input class="toctogglecheckbox" id="toctogglecheckbox" role="button" style="display:none" type="checkbox"/>
       <div class="toctitle" dir="ltr" lang="en">
        <h2 id="mw-toc-heading">
         Contents
        </h2>
        <span class="toctogglespan">
         <label class="toctogglelabel" for="toctogglecheckbox">
         </label>
        </span>
       </div>
       <ul>
        <li class="toclevel-1 tocsection-1">
         <a href="#Flowchart_for_job_cancellation/preemption">
          <span class="tocnumber">
           1
          </span>
          <span class="toctext">
           Flowchart for job cancellation/preemption
          </span>
         </a>
         <ul>
          <li class="toclevel-2 tocsection-2">
           <a href="#Cancellation">
            <span class="tocnumber">
             1.1
            </span>
            <span class="toctext">
             Cancellation
            </span>
           </a>
          </li>
          <li class="toclevel-2 tocsection-3">
           <a href="#Preemption/Requeue">
            <span class="tocnumber">
             1.2
            </span>
            <span class="toctext">
             Preemption/Requeue
            </span>
           </a>
          </li>
         </ul>
        </li>
        <li class="toclevel-1 tocsection-4">
         <a href="#Key_takeaways">
          <span class="tocnumber">
           2
          </span>
          <span class="toctext">
           Key takeaways
          </span>
         </a>
         <ul>
          <li class="toclevel-2 tocsection-5">
           <a href="#On_job_cancellation/preemption">
            <span class="tocnumber">
             2.1
            </span>
            <span class="toctext">
             On job cancellation/preemption
            </span>
           </a>
          </li>
          <li class="toclevel-2 tocsection-6">
           <a href="#On_resuming">
            <span class="tocnumber">
             2.2
            </span>
            <span class="toctext">
             On resuming
            </span>
           </a>
          </li>
         </ul>
        </li>
        <li class="toclevel-1 tocsection-7">
         <a href="#Testing">
          <span class="tocnumber">
           3
          </span>
          <span class="toctext">
           Testing
          </span>
         </a>
        </li>
       </ul>
      </div>
      <h1>
       <span id="Flowchart_for_job_cancellation.2Fpreemption">
       </span>
       <span class="mw-headline" id="Flowchart_for_job_cancellation/preemption">
        Flowchart for job cancellation/preemption
       </span>
      </h1>
      <h2>
       <span class="mw-headline" id="Cancellation">
        Cancellation
       </span>
      </h2>
      <ol>
       <li>
        Slurm controller sends an internal cancel signal to Slurm node(s) where the job is currently assigned.
       </li>
       <li>
        Slurm node(s) send SIGCONT and SIGTERM around the same time, and the following fields of note are set in the output of
        <tt>
         scontrol --json show job $SLURM_JOBID
        </tt>
        :
        <ul>
         <li>
          <tt>
           job_state = ['CANCELLED', 'COMPLETING']
          </tt>
         </li>
        </ul>
       </li>
       <li>
        If the processes don't stop within a certain amount of time, eventually SIGKILL will be sent.
       </li>
      </ol>
      <h2>
       <span id="Preemption.2FRequeue">
       </span>
       <span class="mw-headline" id="Preemption/Requeue">
        Preemption/Requeue
       </span>
      </h2>
      <ol>
       <li>
        Slurm controller sends an internal preemption/requeue signal to Slurm node(s) where the job is currently assigned.
       </li>
       <li>
        Slurm node(s) send SIGCONT and SIGTERM around the same time, and the following fields of note are set in the output of
        <tt>
         scontrol --json show job $SLURM_JOBID
        </tt>
        :
        <ul>
         <li>
          <tt>
           job_state = ['PENDING', 'COMPLETING']
          </tt>
         </li>
         <li>
          <tt>
           restart_cnt += 1
          </tt>
         </li>
        </ul>
       </li>
       <li>
        If the processes don't stop within a certain amount of time, eventually SIGKILL will be sent.
       </li>
       <li>
        Once the job is stopped, it enters the PENDING state for two minutes, and then is eligible to be run again.
       </li>
       <li>
        When the job runs again, an additional environment variable will be defined,
        <tt>
         SLURM_RESTART_COUNT
        </tt>
        , which reports the number of times the job has been preempted/requeued.
       </li>
      </ol>
      <h1>
       <span class="mw-headline" id="Key_takeaways">
        Key takeaways
       </span>
      </h1>
      <h2>
       <span id="On_job_cancellation.2Fpreemption">
       </span>
       <span class="mw-headline" id="On_job_cancellation/preemption">
        On job cancellation/preemption
       </span>
      </h2>
      <p>
       You can handle the SIGTERM signal and run
       <tt>
        scontrol --json show job $SLURM_JOBID
       </tt>
       within your script. Based on the value of
       <tt>
        job_state
       </tt>
       , your script can take a different codepath depending on if it was cancelled or was preempted.
      </p>
      <p>
       The output of
       <tt>
        scontrol --json show job $SLURM_JOBID
       </tt>
       is equivalent to the Slurm REST API's endpoint "GET /slurm/v0.0.40/job/{job_id}". For more information on how to parse the output of this scontrol command, please refer to Slurm's REST API documentation.
       <a class="external autonumber" href="https://slurm.schedmd.com/rest_api.html#slurmV0040GetJob" rel="nofollow">
        [1]
       </a>
      </p>
      <h2>
       <span class="mw-headline" id="On_resuming">
        On resuming
       </span>
      </h2>
      <p>
       If your job needs to behave differently based on whether or not it was previously preempted, you can check if the environment variable
       <tt>
        SLURM_RESTART_COUNT
       </tt>
       is defined.
      </p>
      <h1>
       <span class="mw-headline" id="Testing">
        Testing
       </span>
      </h1>
      <p>
       You can use the following commands to manually cancel and requeue your jobs (requeueing and preemption are handled similarly). With these tools, you can test your scripts to ensure that they gracefully handle these scenarios.
      </p>
      <p>
       Cancellation:
       <tt>
        scancel &lt;job id&gt;
       </tt>
      </p>
      <p>
       Preemption:
       <tt>
        scontrol requeue &lt;job id&gt;
       </tt>
      </p>
     </div>
     <div class="printfooter" data-nosnippet="">
      Retrieved from "
      <a dir="ltr" href="https://wiki.umiacs.umd.edu/umiacs/index.php?title=SLURM/Preemption&amp;oldid=11792">
       https://wiki.umiacs.umd.edu/umiacs/index.php?title=SLURM/Preemption&amp;oldid=11792
      </a>
      "
     </div>
    </div>
    <div class="catlinks catlinks-allhidden" data-mw="interface" id="catlinks">
    </div>
   </div>
  </div>
  <div id="mw-navigation">
   <h2>
    Navigation menu
   </h2>
   <div id="mw-head">
    <nav aria-labelledby="p-personal-label" class="vector-menu mw-portlet mw-portlet-personal vector-user-menu-legacy" id="p-personal" role="navigation">
     <h3 class="vector-menu-heading" id="p-personal-label">
      <span class="vector-menu-heading-label">
       Personal tools
      </span>
     </h3>
     <div class="vector-menu-content">
      <ul class="vector-menu-content-list">
       <li class="mw-list-item" id="pt-login">
        <a accesskey="o" href="/umiacs/index.php?title=Special:UserLogin&amp;returnto=SLURM%2FPreemption" title="You are encouraged to log in; however, it is not mandatory [o]">
         <span>
          Log in
         </span>
        </a>
       </li>
      </ul>
     </div>
    </nav>
    <div id="left-navigation">
     <nav aria-labelledby="p-namespaces-label" class="vector-menu mw-portlet mw-portlet-namespaces vector-menu-tabs vector-menu-tabs-legacy" id="p-namespaces" role="navigation">
      <h3 class="vector-menu-heading" id="p-namespaces-label">
       <span class="vector-menu-heading-label">
        Namespaces
       </span>
      </h3>
      <div class="vector-menu-content">
       <ul class="vector-menu-content-list">
        <li class="selected mw-list-item" id="ca-nstab-main">
         <a accesskey="c" href="/umiacs/index.php/SLURM/Preemption" title="View the content page [c]">
          <span>
           Page
          </span>
         </a>
        </li>
        <li class="new mw-list-item" id="ca-talk">
         <a accesskey="t" href="/umiacs/index.php?title=Talk:SLURM/Preemption&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page (page does not exist) [t]">
          <span>
           Discussion
          </span>
         </a>
        </li>
       </ul>
      </div>
     </nav>
     <nav aria-labelledby="p-variants-label" class="vector-menu mw-portlet mw-portlet-variants emptyPortlet vector-menu-dropdown" id="p-variants" role="navigation">
      <input aria-haspopup="true" aria-labelledby="p-variants-label" class="vector-menu-checkbox" data-event-name="ui.dropdown-p-variants" id="p-variants-checkbox" role="button" type="checkbox"/>
      <label aria-label="Change language variant" class="vector-menu-heading" id="p-variants-label">
       <span class="vector-menu-heading-label">
        English
       </span>
      </label>
      <div class="vector-menu-content">
       <ul class="vector-menu-content-list">
       </ul>
      </div>
     </nav>
    </div>
    <div id="right-navigation">
     <nav aria-labelledby="p-views-label" class="vector-menu mw-portlet mw-portlet-views vector-menu-tabs vector-menu-tabs-legacy" id="p-views" role="navigation">
      <h3 class="vector-menu-heading" id="p-views-label">
       <span class="vector-menu-heading-label">
        Views
       </span>
      </h3>
      <div class="vector-menu-content">
       <ul class="vector-menu-content-list">
        <li class="selected mw-list-item" id="ca-view">
         <a href="/umiacs/index.php/SLURM/Preemption">
          <span>
           Read
          </span>
         </a>
        </li>
        <li class="mw-list-item" id="ca-viewsource">
         <a accesskey="e" href="/umiacs/index.php?title=SLURM/Preemption&amp;action=edit" title="This page is protected.
You can view its source [e]">
          <span>
           View source
          </span>
         </a>
        </li>
        <li class="mw-list-item" id="ca-history">
         <a accesskey="h" href="/umiacs/index.php?title=SLURM/Preemption&amp;action=history" title="Past revisions of this page [h]">
          <span>
           View history
          </span>
         </a>
        </li>
       </ul>
      </div>
     </nav>
     <nav aria-labelledby="p-cactions-label" class="vector-menu mw-portlet mw-portlet-cactions emptyPortlet vector-menu-dropdown" id="p-cactions" role="navigation" title="More options">
      <input aria-haspopup="true" aria-labelledby="p-cactions-label" class="vector-menu-checkbox" data-event-name="ui.dropdown-p-cactions" id="p-cactions-checkbox" role="button" type="checkbox"/>
      <label class="vector-menu-heading" id="p-cactions-label">
       <span class="vector-menu-heading-label">
        More
       </span>
      </label>
      <div class="vector-menu-content">
       <ul class="vector-menu-content-list">
       </ul>
      </div>
     </nav>
     <div class="vector-search-box-vue vector-search-box-show-thumbnail vector-search-box-auto-expand-width vector-search-box" id="p-search" role="search">
      <div>
       <h3>
        <label for="searchInput">
         Search
        </label>
       </h3>
       <form action="/umiacs/index.php" class="vector-search-box-form" id="searchform">
        <div class="vector-search-box-inner" data-search-loc="header-navigation" id="simpleSearch">
         <input accesskey="f" aria-label="Search UMIACS" autocapitalize="sentences" class="vector-search-box-input" id="searchInput" name="search" placeholder="Search UMIACS" title="Search UMIACS [f]" type="search"/>
         <input name="title" type="hidden" value="Special:Search"/>
         <input class="searchButton mw-fallbackSearchButton" id="mw-searchButton" name="fulltext" title="Search the pages for this text" type="submit" value="Search"/>
         <input class="searchButton" id="searchButton" name="go" title="Go to a page with this exact name if it exists" type="submit" value="Go"/>
        </div>
       </form>
      </div>
     </div>
    </div>
   </div>
   <div id="mw-panel">
    <div id="p-logo" role="banner">
     <a class="mw-wiki-logo" href="/umiacs/index.php/Main_Page" title="Visit the main page">
     </a>
    </div>
    <nav aria-labelledby="p-navigation-label" class="vector-menu mw-portlet mw-portlet-navigation vector-menu-portal portal" id="p-navigation" role="navigation">
     <h3 class="vector-menu-heading" id="p-navigation-label">
      <span class="vector-menu-heading-label">
       Navigation
      </span>
     </h3>
     <div class="vector-menu-content">
      <ul class="vector-menu-content-list">
       <li class="mw-list-item" id="n-mainpage">
        <a accesskey="z" href="/umiacs/index.php/Main_Page" title="Visit the main page [z]">
         <span>
          Main Page
         </span>
        </a>
       </li>
       <li class="mw-list-item" id="n-Getting-Started">
        <a href="/umiacs/index.php/GettingStarted">
         <span>
          Getting Started
         </span>
        </a>
       </li>
       <li class="mw-list-item" id="n-Core-Services">
        <a href="/umiacs/index.php/CoreServices">
         <span>
          Core Services
         </span>
        </a>
       </li>
       <li class="mw-list-item" id="n-Lab-Facilities">
        <a href="/umiacs/index.php/LabFacilities">
         <span>
          Lab Facilities
         </span>
        </a>
       </li>
       <li class="mw-list-item" id="n-Placing-Orders">
        <a href="/umiacs/index.php/Orders">
         <span>
          Placing Orders
         </span>
        </a>
       </li>
       <li class="mw-list-item" id="n-Support">
        <a href="/umiacs/index.php/HelpDesk">
         <span>
          Support
         </span>
        </a>
       </li>
      </ul>
     </div>
    </nav>
    <nav aria-labelledby="p-tb-label" class="vector-menu mw-portlet mw-portlet-tb vector-menu-portal portal" id="p-tb" role="navigation">
     <h3 class="vector-menu-heading" id="p-tb-label">
      <span class="vector-menu-heading-label">
       Tools
      </span>
     </h3>
     <div class="vector-menu-content">
      <ul class="vector-menu-content-list">
       <li class="mw-list-item" id="t-whatlinkshere">
        <a accesskey="j" href="/umiacs/index.php/Special:WhatLinksHere/SLURM/Preemption" title="A list of all wiki pages that link here [j]">
         <span>
          What links here
         </span>
        </a>
       </li>
       <li class="mw-list-item" id="t-recentchangeslinked">
        <a accesskey="k" href="/umiacs/index.php/Special:RecentChangesLinked/SLURM/Preemption" rel="nofollow" title="Recent changes in pages linked from this page [k]">
         <span>
          Related changes
         </span>
        </a>
       </li>
       <li class="mw-list-item" id="t-specialpages">
        <a accesskey="q" href="/umiacs/index.php/Special:SpecialPages" title="A list of all special pages [q]">
         <span>
          Special pages
         </span>
        </a>
       </li>
       <li class="mw-list-item" id="t-print">
        <a accesskey="p" href="javascript:print();" rel="alternate" title="Printable version of this page [p]">
         <span>
          Printable version
         </span>
        </a>
       </li>
       <li class="mw-list-item" id="t-permalink">
        <a href="/umiacs/index.php?title=SLURM/Preemption&amp;oldid=11792" title="Permanent link to this revision of this page">
         <span>
          Permanent link
         </span>
        </a>
       </li>
       <li class="mw-list-item" id="t-info">
        <a href="/umiacs/index.php?title=SLURM/Preemption&amp;action=info" title="More information about this page">
         <span>
          Page information
         </span>
        </a>
       </li>
      </ul>
     </div>
    </nav>
   </div>
  </div>
  <footer class="mw-footer" id="footer" role="contentinfo">
   <ul id="footer-info">
    <li id="footer-info-lastmod">
     This page was last edited on 10 May 2024, at 15:54.
    </li>
   </ul>
   <ul id="footer-places">
    <li id="footer-places-privacy">
     <a href="/umiacs/index.php/UMIACS:Privacy_policy">
      Privacy policy
     </a>
    </li>
    <li id="footer-places-about">
     <a href="/umiacs/index.php/UMIACS:About">
      About UMIACS
     </a>
    </li>
    <li id="footer-places-disclaimer">
     <a href="/umiacs/index.php/UMIACS:General_disclaimer">
      Disclaimers
     </a>
    </li>
   </ul>
   <ul class="noprint" id="footer-icons">
    <li id="footer-poweredbyico">
     <a href="https://www.mediawiki.org/">
      <img alt="Powered by MediaWiki" height="31" loading="lazy" src="/umiacs/resources/assets/poweredby_mediawiki_88x31.png" srcset="/umiacs/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /umiacs/resources/assets/poweredby_mediawiki_176x62.png 2x" width="88"/>
     </a>
    </li>
   </ul>
  </footer>
  <script>
   (RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.007","walltime":"0.008","ppvisitednodes":{"value":21,"limit":1000000},"postexpandincludesize":{"value":0,"limit":2097152},"templateargumentsize":{"value":0,"limit":2097152},"expansiondepth":{"value":2,"limit":100},"expensivefunctioncount":{"value":0,"limit":100},"unstrip-depth":{"value":0,"limit":20},"unstrip-size":{"value":0,"limit":5000000},"timingprofile":["100.00%    0.000      1 -total"]},"cachereport":{"timestamp":"20241002161013","ttl":86400,"transientcontent":false}}});mw.config.set({"wgBackendResponseTime":144});});
  </script>
 </body>
</html>
